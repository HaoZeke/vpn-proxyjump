# Usage:
#   1. Copy and customise the environment variables below
#   2. Set your public key:
#        export PUB_KEY_CONTENT=$(cat ~/.ssh/id_ed25519.pub)
#   3. docker compose up --build
#
# For non-interactive password, either:
#   - Set VPN_PASSWORD in the environment section, OR
#   - Place the password in ./secrets/vpn_password and uncomment the secrets/volumes lines

services:
  vpn-jumphost:
    build:
      context: .
      args:
        SSH_USER_NAME: jumphostuser
        USER_PUBLIC_KEY: "${PUB_KEY_CONTENT}"
    # Or use a prebuilt image:
    # image: ghcr.io/haozeke/vpn-proxyjump:latest
    container_name: vpn-smart-jump-container
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - "127.0.0.1:2200:22"
    environment:
      VPN_SERVER: "vpn.example.com"
      VPN_USER: "your_username"
      VPN_TYPE: "openconnect"           # or "openfortivpn"
      OPENCONNECT_EXTRA_ARGS: ""        # e.g. "--useragent=AnyConnect"
      # VPN_PASSWORD: ""                # or use a secrets file (see below)
      VPN_RECONNECT: "true"
      VPN_RECONNECT_DELAY: "5"
    # Uncomment for file-based password:
    # volumes:
    #   - ./secrets/vpn_password:/run/secrets/vpn_password:ro
    stdin_open: true
    tty: true
    restart: unless-stopped
